# Построение сети ЦОД для связности двух сайтов по L2 и L3.

В данной работе рассмотрим обеспечение связности между двумя сайтами с использованием VXLAN EVPN, и используя технологии которые мы рассматривали в лабах, такие как ESI multihomming, l2vni, l3vni.

Для упрощения схемы мы не будем дублировать некоторые устройства, такие как SPINE или PE.

Фабрика строится на Juniper vQFX

---
## Схема:
![img_1.png](scheme.png)

На каждом сайте будут по 2 лифа, к которым будут подключены роутеры для выхода во вне, а также хосты. По одному хосту на каждом сайте мы вынесем в обзий L2 домен, для проверки L2 связности, и по одному хосту оставим каждый в своем влане, для проверки L3 связности. Маршрутизаторы будут подключаться с помощью агрегата. Так же на каждом сайте будет по одному бордер лифу, для подключения к суперспайну и обеспечения связности между сайтами. Так же добавим подключение клиентского роутера и хоста за ним для эмуляции спуска full view bgp по l2 с PE маршрутизатора.

## Адресация:

В качестве сетей для распределения выбраны сети:
| Название | Сеть | Vlan |
|----------|------|------|
| P2P FABRIC | 10.100.0.0/24 | - |
| Loopback | 10.200.0.0/24 | - |
| P2P WAN | 100.64.0.0/24 | 1000 |
| CLIENT_1 | 100.64.10.0/24 | 100 |
| CLIENT_2 | 100.64.20.0/24 | 200 |
| CLIENT_3 | 100.64.30.0/24 | 300 |
| CLIENT_4_WAN | 100.64.40.0/24 | 400 |
| CLIENT_4_LAN | 10.0.0.0/24 | - |

### Распределение адресации:

P2P FABRIC:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-A-SPINE-1      | xe-0/0/0      | SITE-A-LEAF-1       | xe-0/0/0      | 10.100.0.0/31         | 10.100.0.1/31  |
| SITE-A-SPINE-1     | xe-0/0/1      | SITE-A-LEAF-2       | xe-0/0/0      | 10.100.0.2/31         | 10.100.0.3/31  |
| SITE-A-SPINE-1     | xe-0/0/2      | SITE-A-BLEAF-1       | xe-0/0/0      | 10.100.0.4/31         | 10.100.0.5/31  |
| SITE-B-SPINE-1      | xe-0/0/0      | SITE-B-LEAF-1       | xe-0/0/0      | 10.100.0.6/31         | 10.100.0.7/31  |
| SITE-B-SPINE-1      | xe-0/0/1      | SITE-B-LEAF-2       | xe-0/0/0      | 10.100.0.8/31         | 10.100.0.9/31  |
| SITE-B-SPINE-1      | xe-0/0/2      | SITE-B-BLEAF-1       | xe-0/0/0      | 10.100.0.10/31         | 10.100.0.11/31  |
| SUPER-SPINE      | xe-0/0/0      | SITE-A-BLEAF-1       | xe-0/0/1      | 10.100.0.12/31         | 10.100.0.13/31  |
| SUPER-SPINE      | xe-0/0/1      | SITE-B-BLEAF-1       | xe-0/0/1      | 10.100.0.14/31         | 10.100.0.15/31  |

Loopback:

| Устройство   | Интерфейс | IP-адрес       |
|--------------|-----------|----------------|
| SITE-A-SPINE-1       | Loopback0 | 10.200.0.1/32  |
| SITE-B-SPINE-1      | Loopback0 | 10.200.0.2/32  |
| SUPER-SPINE       | Loopback0 | 10.200.0.3/32  |
| SITE-A-LEAF-1       | Loopback0 | 10.200.0.4/32  |
| SITE-A-LEAF-2       | Loopback0 | 10.200.0.5/32  |
| SITE-A-BLEAF-1       | Loopback0 | 10.200.0.6/32  |
| SITE-B-LEAF-1       | Loopback0 | 10.200.0.7/32  |
| SITE-B-LEAF-2       | Loopback0 | 10.200.0.8/32  |
| SITE-B-BLEAF-1       | Loopback0 | 10.200.0.9/32  |

P2P WAN:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-A-PE-1      | e0/1(Po1.1000)      | SITE-A-LEAF-1       | xe-0/0/1(irb.1000)      | 100.64.0.0/31         | 100.64.0.1/31  |
| SITE-A-PE-1     | e0/2(Po1.1000)      | SITE-A-LEAF-2       | xe-0/0/1(irb.1000)      | 100.64.0.2/31         | 100.64.0.3/31  |
| SITE-B-PE-1     | e0/1(Po1.1000)       | SITE-B-LEAF-1       | xe-0/0/1(irb.1000)      | 100.64.0.4/31         | 100.64.0.4/31  |
| SITE-B-PE-1      | e0/2(Po1.1000)       | SITE-B-LEAF-2       | xe-0/0/1(irb.1000)      | 100.64.0.6/31         | 100.64.0.5/31  |

CLIENT_1:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-A-HOST_L2-1      | e0      | SITE-A-LEAF-1       | xe-0/0/2(irb.100)      | 100.64.10.10/24         | 100.64.10.1/24(anycast)  |
| SITE-B-HOST_L2-1     | e0      | SITE-B-LEAF-1       | xe-0/0/2(irb.100)      | 100.64.10.20/24         | 100.64.10.1/24(anycast)  |

CLIENT_2:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-A-HOST_L3-1      | e0      | SITE-A-LEAF-2       | xe-0/0/2(irb.200)      | 100.64.20.10/24         | 100.64.20.1/24  |

CLIENT_3:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-B-HOST_L3-1      | e0      | SITE-B-LEAF-2       | xe-0/0/2(irb.300)      | 100.64.30.10/24         | 100.64.30.1/24  |

CLIENT_4_WAN:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-A-PE-1      | Po1.400      | SITE-B-R-1       | e0/0      | 100.64.40.1/24         | 100.64.40.3/24  |
| SITE-B-PE-1    | Po1.400      | SITE-B-R-1       | e0/0      | 100.64.40.2/24         | 100.64.40.3/24  |

CLIENT_4_LAN:

| Устройство 1 | Интерфейс | Устройство 2 | Интерфейс | IP-адрес устройства 1 | IP-адрес устройства 2 |
|--------------|-----------|--------------|-----------|-----------------------|-----------------------|
| SITE-B-R-1      | e0/1      | SITE-B-HOST-BGP-1       | e0      | 10.0.0.1/24         | 10.0.0.2/24  |


